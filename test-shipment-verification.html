
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipment Verification Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .verification-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }
        .status-success { border-left: 4px solid #28a745; }
        .status-error { border-left: 4px solid #dc3545; }
        .status-warning { border-left: 4px solid #ffc107; }
        .test-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">
            <i class="fas fa-search"></i> Shipment Verification Tool
        </h1>

        <!-- Quick Tests -->
        <div class="row">
            <div class="col-md-6">
                <div class="verification-card">
                    <h5><i class="fas fa-plug"></i> Test Shiprocket Connection</h5>
                    <button class="btn btn-primary" onclick="testConnection()">
                        <i class="fas fa-wifi"></i> Test Connection
                    </button>
                    <div id="connectionResult" class="test-result mt-2" style="display: none;"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="verification-card">
                    <h5><i class="fas fa-list"></i> Check Your Orders</h5>
                    <button class="btn btn-info" onclick="checkOrders()">
                        <i class="fas fa-box"></i> Get Recent Orders
                    </button>
                    <div id="ordersResult" class="test-result mt-2" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Specific ID Verification -->
        <div class="verification-card">
            <h5><i class="fas fa-search"></i> Verify Your Specific IDs</h5>
            <div class="row">
                <div class="col-md-4">
                    <label class="form-label">Shipment ID:</label>
                    <input type="text" class="form-control" id="shipmentId" value="929330109">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Order ID:</label>
                    <input type="text" class="form-control" id="orderId" value="932878381">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Channel Order ID:</label>
                    <input type="text" class="form-control" id="channelOrderId" value="TEST-1755402031807-n4vdkdq39">
                </div>
            </div>
            <div class="mt-3">
                <button class="btn btn-success me-2" onclick="verifyShipmentId()">
                    <i class="fas fa-truck"></i> Verify Shipment ID
                </button>
                <button class="btn btn-warning me-2" onclick="trackOrderId()">
                    <i class="fas fa-search"></i> Track Order ID
                </button>
                <button class="btn btn-secondary" onclick="trackChannelOrder()">
                    <i class="fas fa-barcode"></i> Track Channel Order
                </button>
            </div>
            <div id="verificationResult" class="test-result mt-2" style="display: none;"></div>
        </div>

        <!-- Account Information -->
        <div class="verification-card">
            <h5><i class="fas fa-user"></i> Account Information</h5>
            <button class="btn btn-info" onclick="getAccountInfo()">
                <i class="fas fa-info-circle"></i> Get Account Details
            </button>
            <div id="accountResult" class="test-result mt-2" style="display: none;"></div>
        </div>

        <!-- Navigation -->
        <div class="text-center mt-4">
            <a href="test-shiprocket.html" class="btn btn-outline-primary me-2">
                <i class="fas fa-vial"></i> Shiprocket Tests
            </a>
            <a href="admin-professional-final.html" class="btn btn-outline-secondary me-2">
                <i class="fas fa-cog"></i> Admin Panel
            </a>
            <a href="index.html" class="btn btn-outline-success">
                <i class="fas fa-home"></i> Home
            </a>
        </div>
    </div>

    <script>
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = content;
            element.className = `test-result mt-2 ${type}`;
        }

        async function testConnection() {
            showResult('connectionResult', 'Testing connection...', 'info');
            
            try {
                const response = await fetch('/.netlify/functions/shiprocket-test-connection');
                const result = await response.json();
                
                if (result.success) {
                    showResult('connectionResult', `✅ Connection Successful!\n\nAccount Details:\n${JSON.stringify(result.company_data, null, 2)}`, 'success');
                } else {
                    showResult('connectionResult', `❌ Connection Failed:\n${result.error}\n\nDetails: ${JSON.stringify(result.details, null, 2)}`, 'error');
                }
            } catch (error) {
                showResult('connectionResult', `❌ Error: ${error.message}`, 'error');
            }
        }

        async function checkOrders() {
            showResult('ordersResult', 'Fetching recent orders...', 'info');
            
            try {
                const response = await fetch('/.netlify/functions/shiprocket-get-orders');
                const result = await response.json();
                
                if (result.success) {
                    const orders = result.data.data || [];
                    let ordersList = `✅ Found ${orders.length} orders:\n\n`;
                    
                    orders.slice(0, 5).forEach(order => {
                        ordersList += `Order ID: ${order.id}\n`;
                        ordersList += `Channel Order ID: ${order.channel_order_id}\n`;
                        ordersList += `Status: ${order.status}\n`;
                        ordersList += `Created: ${order.created_at}\n`;
                        ordersList += `---\n`;
                    });
                    
                    showResult('ordersResult', ordersList, 'success');
                } else {
                    showResult('ordersResult', `❌ Failed to get orders:\n${result.error}`, 'error');
                }
            } catch (error) {
                showResult('ordersResult', `❌ Error: ${error.message}`, 'error');
            }
        }

        async function verifyShipmentId() {
            const shipmentId = document.getElementById('shipmentId').value;
            showResult('verificationResult', `Verifying Shipment ID: ${shipmentId}...`, 'info');
            
            try {
                const response = await fetch(`/.netlify/functions/shiprocket-track-order/${shipmentId}`);
                const result = await response.json();
                
                if (result.success) {
                    showResult('verificationResult', `✅ Shipment Found!\n\nTracking Data:\n${JSON.stringify(result.data, null, 2)}`, 'success');
                } else {
                    showResult('verificationResult', `❌ Shipment Not Found:\n${result.error}\n\nThis shipment ID doesn't exist in your Shiprocket account.`, 'error');
                }
            } catch (error) {
                showResult('verificationResult', `❌ Error: ${error.message}`, 'error');
            }
        }

        async function trackOrderId() {
            const orderId = document.getElementById('orderId').value;
            showResult('verificationResult', `Tracking Order ID: ${orderId}...`, 'info');
            
            try {
                const response = await fetch(`/.netlify/functions/shiprocket-track-order/${orderId}`);
                const result = await response.json();
                
                if (result.success) {
                    showResult('verificationResult', `✅ Order Found!\n\nTracking Data:\n${JSON.stringify(result.data, null, 2)}`, 'success');
                } else {
                    showResult('verificationResult', `❌ Order Not Found:\n${result.error}\n\nThis order ID doesn't exist in your Shiprocket account.`, 'error');
                }
            } catch (error) {
                showResult('verificationResult', `❌ Error: ${error.message}`, 'error');
            }
        }

        async function trackChannelOrder() {
            const channelOrderId = document.getElementById('channelOrderId').value;
            showResult('verificationResult', `Tracking Channel Order ID: ${channelOrderId}...`, 'info');
            
            try {
                const response = await fetch(`/.netlify/functions/shiprocket-track-order/${channelOrderId}`);
                const result = await response.json();
                
                if (result.success) {
                    showResult('verificationResult', `✅ Channel Order Found!\n\nTracking Data:\n${JSON.stringify(result.data, null, 2)}`, 'success');
                } else {
                    showResult('verificationResult', `❌ Channel Order Not Found:\n${result.error}\n\nThis channel order ID doesn't exist in your Shiprocket account.`, 'error');
                }
            } catch (error) {
                showResult('verificationResult', `❌ Error: ${error.message}`, 'error');
            }
        }

        async function getAccountInfo() {
            showResult('accountResult', 'Getting account information...', 'info');
            
            try {
                const response = await fetch('/.netlify/functions/shiprocket-diagnose');
                const result = await response.json();
                
                if (result.success) {
                    showResult('accountResult', `✅ Account Information:\n\n${JSON.stringify(result.data, null, 2)}`, 'success');
                } else {
                    showResult('accountResult', `❌ Failed to get account info:\n${result.error}`, 'error');
                }
            } catch (error) {
                showResult('accountResult', `❌ Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
