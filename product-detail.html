<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nazakat</title>
    <link rel="stylesheet" href="css/styles.css?v=1.0.4">
    <link rel="stylesheet" href="css/responsive.css?v=1.0.4">
    <link rel="stylesheet" href="css/navbar.css?v=1.1.3">
    <link rel="stylesheet" href="css/cart.css?v=1.0.2">
    <link rel="stylesheet" href="css/product-detail-gallery.css?v=1.0.0">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.4.0/css/all.min.css" integrity="sha384-iw3OoTErCYJJB9mCa8LNS2hbsQ7M3C0EpLGCJKypKP/lLCgB9MlH/lX+/Pvw2DNA" crossorigin="anonymous">
    <!-- Fallback font awesome icons if CDN fails -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;500;700&family=Lora:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/product-detail-fix.css">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCrLCButDevLeILcBjrUCd9e7amXVjW-uI",
            authDomain: "auric-a0c92.firebaseapp.com",
            projectId: "auric-a0c92",
            storageBucket: "auric-a0c92.appspot.com",
            messagingSenderId: "878979958342",
            appId: "1:878979958342:web:e6092f7522488d21eaec47",
            measurementId: "G-ZYZ750JHMB"
        };

        // Initialize Firebase immediately instead of waiting for DOMContentLoaded
        console.log('Initializing Firebase...');
        try {
            firebase.initializeApp(firebaseConfig);
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Error initializing Firebase:', error);
        }
    </script>

    <!-- Cart Persistence Script -->
    <script>
        // Modified cart check to never clear cart on page load
        (function() {
            console.log('Cart persistence enabled: Cart will not be cleared on page reload');

            // Only check for this flag when explicitly navigating from checkout after order
            function checkCartShouldBeCleared() {
                // This will only be true if coming directly from checkout after order completion
                // and ONLY if the global flag was set by checkout.js
                return window.FORCE_CART_CLEAR_NEEDED === true;
            }

            // This will be false in normal navigation - preserving cart data
            if (checkCartShouldBeCleared()) {
                console.log('Cart clearing confirmed from recent order completion');
            }
        })();
    </script>
</head>
    <style>
      /* Login page specific styles - Force black navigation elements */

      /* Navigation links in desktop */
      .nav-link {
          color: #000 !important;
      }

      /* Navigation links hover state */
      .nav-link:hover {
          color: #333 !important;
      }
/* Dropdown arrow icons */
      .dropdown-toggle i {
          color: #000 !important;
      }

      /* Mobile menu close button */
      .meenu-close {
          color: #000 !important;
      }

      /* Mobile navigation links */
      .mobile-account-link {
          color: #000 !important;
      }

      /* Mobile navigation link text */
      .mobile-account-links .mobile-account-link {
          color: #000 !important;
      }

      /* Navigation icons - all icon images */
      .nav-icons .icon-link img {
          filter: brightness(0) !important;
      }

      /* Hamburger menu icon */
      .hamburger img {
          filter: brightness(0) !important;
      }

      /* Cart and wishlist count badges *
      .cart-count,
      .wishlist-count,
      .mobile-cart-count,
      .mobile-wishlist-count {
background-color: #000 !important;
          color: #fff !important;
      }

      /* Dropdown menu items */
      .dropdown-menu li a {
          color: #000 !important;
      }

      /* Dropdown menu items hover */
      .dropdown-menu li a:hover {
          color: #333 !important;
          background-color: #f5f5f5 !important;
      }

      /* Mobile menu background text color */
      .nav-menu {
          color: #000 !important;
      }

      /* Ensure all text in mobile menu is black */
      .nav-menu * {
          color: #000 !important;
      }

      /* Mobile account links images */
      .mobile-account-link img {
          filter: brightness(0) !important;
      }

      /* Hide mobile menu close button on large devices */
      @media (min-width: 769px) {
          #closeMenu {
              display: none !important;
          }
      }

      /* Add top spacing to login section */
      .auth-container {
          margin-top: 200px !important;
      }

      /* Responsive spacing for different screen sizes */
      @media (max-width: 768px) {
          .auth-container {
              margin-top: 120px !important;
          }
}

      /* Remove shadow from navigation links on large devices */
      @media (min-width: 769px) {
          .nav-link {
              text-shadow: none !important;
              box-shadow: none !important;
          }

          .nav-link:hover {
              text-shadow: none !important;
              box-shadow: none !important;
          }
      }
              </style>
<body>
    <!-- Header -->
    <header class="header">
        <!-- Promo Banner -->
        <div class="promo-banner">
            <button class="banner-arrow banner-prev">
                <i class="fas fa-chevron-left"></i>
            </button>
            <p>Save 21% on exclusive selections - <a href="#">Shop Now</a></p>
            <button class="banner-arrow banner-next">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- New Responsive Navigation -->
        <nav class="navbar">
            <div class="nav-container">
                <!-- Logo -->
                <a href="index.html" class="brand">
                    <img src="images/logos/IMG_20250801_204447.jpg" alt="Nazakat" class="brand-logo">
                </a>

                <!-- Mobile Toggle Button -->
                <div class="hamburger" id="navToggle"><img src="images/icons/bars-staggered (2).png" alt="nazakat"style="width: 25px; height: 25px;">
                </div>
              <!--  <div class="hamburger" id="navToggle">
                    <i class="fas fa-bars"></i>
                </div>-->

                <!-- Navigation Links -->
                <div class="nav-menu" id="navMenu">
                    <!-- Close button for mobile menu in the top right corner -->
                    <i id="closeMenu" class="fa-solid fa-xmark meenu-close" onclick="closeMobileMenu()" style="font-size: 24px; margin-left: 90%; color: #333;" ></i>

                    <ul class="nav-list">
                        <li class="nav-item"><a href="new-arrivals.html" class="nav-link">New Arrivals</a></li>
                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle">Collections <i class="fas fa-chevron-down"></i></a>
                            <ul class="dropdown-menu">
                                <li><a href="shop.html">All Collection</a></li>
                                <li><a href="featured-collection.html">Featured Collection</a></li>
                                <li><a href="saree-collection.html">Saree Collection</a></li>
                            </ul>
                        </li>
                        <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
                        <li class="nav-item"><a href="index.html#customer-reviews" class="nav-link">Testimonials</a></li>
                        <li class="nav-item"><a href="order-track.html" class="nav-link">Order Track</a></li>
                        <li class="nav-item"><a href="#" class="nav-link">Contact</a></li>
                    </ul>

                    <!-- Mobile account links in separate div after Contact -->
                    <div class="mobile-account-links mobile-special">
                        <a href="#" class="mobile-account-link">
                            <img src="images/icons/user.png" alt="Cart" style="width: 18px; height: 18px;">  &nbsp; Account
                        </a>
                        <a href="#" class="mobile-account-link wishlist-toggle">
                            <img src="images/icons/heart.png" alt="Cart" style="width: 18px; height: 18px;"> &nbsp;   Wishlist (<span class="mobile-wishlist-count">0</span>)
                        </a>
                        <a href="#" class="mobile-account-link mobile-cart-toggle">
                            <img src="images/icons/cart-minus.png" alt="Cart" style="width:18px; height: 18px; vertical-align: middle;">  &nbsp; Shopping Bag (<span class="mobile-cart-count">0</span>)
                        </a>
                    </div>
                </div>

                <!-- Navigation Icons -->
                <div class="nav-icons">
                    <a href="#" class="icon-link search-icon">
                        <img src="images/icons/search.png" alt="Search" style="width: 20px; height: 20px;">
                    </a>
                    <a href="login.html" class="icon-link account-icon" id="user-icon">
                        <img src="images/icons/user.png" alt="User" style="width: 25px; height: 25px;">
                    </a>
                    <a href="#" class="icon-link wishlist-icon-container wishlist-toggle">
                        <img src="images/icons/heart.png" alt="Wishlist" style="width: 20px; height: 20px;">
                        <div class="wishlist-count">0</div>
                    </a>
                    <a href="#" class="icon-link cart-icon-container cart-toggle" id="cartToggleButton">
                        <img src="images/icons/cart-minus.png" alt="Cart" style="width: 20px; height: 20px;">
                        <div class="cart-count">0</div>
                    </a>
                </div>
            </div>
        </nav>
    </header>
   <!-- <header class="header">
        <!-- Promo Banner --
        <div class="promo-banner">
            <button class="banner-arrow banner-prev">
                <i class="fas fa-chevron-left"></i>
            </button>
            <p>Save 21% on exclusive selections - <a href="#">Shop Now</a></p>
            <button class="banner-arrow banner-next">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- New Responsive Navigation --
        <nav class="navbar">
            <div class="nav-container">
                <!-- Logo --
                <a href="index.html" class="brand">Auric</a>


                <!-- Mobile Toggle Button --
                <div class="hamburger" id="navToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>

                <!-- Navigation Links --
                <div class="nav-menu" id="navMenu">
                    <!-- Close button for mobile menu in the top right corner --
                    <button class="close-menu" id="closeMenu">×</button>

                    <ul class="nav-list">
                        <li class="nav-item"><a href="new-arrivals.html" class="nav-link">New Arrivals</a></li>
                        <li class="nav-item"><a href="shop.html" class="nav-link">Shop</a></li>
                        <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
                        <li class="nav-item"><a href="index.html#customer-reviews" class="nav-link">Testimonials</a></li>
                        <li class="nav-item"><a href="order-track.html" class="nav-link">Order Track</a></li>
                        <li class="nav-item"><a href="#" class="nav-link">Contact</a></li>
                    </ul>

                    <!-- Mobile account links in separate div after Contact --
                    <div class="mobile-account-links mobile-special">
                        <a href="login.html" class="mobile-account-link">
                            <i class="fas fa-user"></i> Account
                        </a>
                        <a href="#" class="mobile-account-link wishlist-toggle">
                            <i class="fas fa-heart"></i> Wishlist (<span class="mobile-wishlist-count">0</span>)
                        </a>
                        <a href="#" class="mobile-account-link mobile-cart-toggle">
                            <i class="fas fa-shopping-bag"></i> Shopping Bag (<span class="mobile-cart-count">0</span>)
                        </a>

                    </div>
                </div>

            <!-- Navigation Icons - Matching the image --
                <div class="nav-icons">
                    <a href="#" class="icon-link"><i class="fa-solid fa-magnifying-glass"></i></a>
                    <a href="login.html" class="icon-link" id="user-icon"><i class="fa-solid fa-user"></i></a>
                    <a href="#" class="icon-link wishlist-icon-container">
                        <i class="fa-solid fa-heart"></i>
                        <div class="wishlist-count">0</div>
                    </a>
                    <a href="#" class="icon-link cart-icon-container cart-toggle" id="cartToggleButton">
                        <i class="fa-solid fa-bag-shopping"></i>
                        <div class="cart-count">0</div>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Overlay for menu background -->
    <div class="menu-overlay" id="menuOverlay"></div>


    <main>
        <div class="product-detail-container" data-product-id="EM-ST-2025">
            <!-- Left side: Image gallery -->
            <div class="product-detail-left">
                <div class="main-image-container" style="height: 650px !important; min-height: 450px !important;">
                    <img class="product-main-image" style="display: none;">
                    <div class="image-zoom-overlay" style="display: none;">
                        <img src="" alt="Zoomed Image" class="zoomed-image">
                        <button class="zoom-close">&times;</button>
                    </div>
                </div>
                <div class="product-detail-images">
                    <div class="product-thumbnails">
                        <!-- Thumbnails will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Right side: Product info -->
            <div class="product-detail-right">
                <div class="product-detail-info">
                    <h1 class="product-title">Loading Product...</h1>
                    <div class="price">
                        <span class="product-price price-value">₹0.00</span>
                    </div>

                    <div class="product-meta">
                        <div class="meta-item">
                            <span class="meta-label">Brand:</span>
                            <span class="meta-value">Nazakat</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Availability:</span>
                            <span class="meta-value in-stock">In stock ✓</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">SKU:</span>
                            <span class="meta-value">Loading...</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Category:</span>
                            <span class="meta-value">Loading...</span>
                        </div>
                    </div>

                    <div class="product-quantity">
                        <button class="quantity-btn decrement">-</button>
                        <input type="text" value="1" class="quantity-input" readonly>
                        <button class="quantity-btn increment">+</button>
                    </div>

                    <div class="product-actions">
                        <button class="add-to-cart-btn">ADD TO CART</button>
                        <button class="buy-now-btn">BUY NOW</button>
                        <button class="add-to-wishlist-btn"><i class="fas fa-heart"></i> ADD TO WISHLIST</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product details in horizontal layout below -->
        <div class="product-details-horizontal">
            <div class="product-description">
                <h3>Product Description</h3>
                <p>Handcrafted with precision, these exquisite emerald studs feature brilliant-cut natural emeralds set in 18-karat gold. The intense green color of these premium quality emeralds is perfectly complemented by the warm gold setting, creating a timeless accessory suitable for both everyday wear and special occasions.</p>
            </div>

            
        </div>

        <!-- You May Also Like Section -->
        <section class="you-may-also-like full-width-section">
            <div class="container">
                <h2 class="section-title">You May Also Like</h2>
            </div>
            <div class="product-scroll-container" id="you-may-also-like-container">
                <!-- Products will be loaded dynamically by JavaScript -->
                <div class="loading-message">Loading related products...</div>
            </div>

                <!-- Product Item 5 --
                <div class="product-item" data-product-id="GLBR-11">
                    <div class="product-image">
                        <img src="images/product-category/IMG_20250504_150322.jpg" alt="Gold Bracelet">
                        <button class="add-to-wishlist"><i class="far fa-heart"></i></button>
                        
                    </div>
                    <div class="product-details">
                        <h3 class="product-name">Gold Bracelet</h3>
                        <div class="product-pricing">
                            <span class="current-price">₹42999.00</span>
                            
                        </div>
                    </div>
                </div>

                <!-- Product Item 6 --
                <div class="product-item" data-product-id="SLAT-12">
                    <div class="product-image">
                        <img src="images/product-category/IMG_20250504_150336.jpg" alt="Silver Anklet">
                        <button class="add-to-wishlist"><i class="far fa-heart"></i></button>
                        
                    </div>
                    <div class="product-details">
                        <h3 class="product-name">Silver Anklet</h3>
                        <div class="product-pricing">
                            <span class="current-price">₹15499.00</span>
                            
                        </div>
                    </div>
                </div>-->
            </div>
        </section>
    </main>

    <a href="https://wa.me/919310250047?text=Hi! I'm interested in this product. Can you help me?" class="whatsapp-btn">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Footer Toggle Script -->
    <script src="js/footer-toggle.js"></script>

<!-- Minimalist Collapsible Footer -->
    <footer class="footer-minimalist">
        <div class="container">
            <!-- Info Section -->
            <div class="footer-section">
                <button class="footer-toggle" data-section="info-content">
                    <span class="footer-title">Info</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="footer-content" id="info-content">
                    <ul>
                        <li><a href="#">Our Story</a></li>
                        <li><a href="#">Shipping Policy</a></li>
                        <li><a href="#">Returns & Exchanges</a></li>
                        <li><a href="#">Size Guide</a></li>
                        <li><a href="#">Care Instructions</a></li>
                        <li><a href="terms-and-conditions.html">Terms and conditions</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>

            <!-- Categories Section -->
            <div class="footer-section">
                <button class="footer-toggle" data-section="categories-content">
                    <span class="footer-title">Categories</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="footer-content" id="categories-content">
                    <ul>
                        <li><a href="#">Saree</a></li>
                        <li><a href="#">Lehenga</a></li>
                        <li><a href="#">Suit</a></li>
                    </ul>
                </div>
            </div>

            <!-- Collection Section -->
            <div class="footer-section">
                <button class="footer-toggle" data-section="collection-content">
                    <span class="footer-title">Collection</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="footer-content" id="collection-content">
                    <ul>
                        
                        <li><a href="#">New Arrivals</a></li>
                        <li><a href="#">Saree Collection</a></li>
                        <li><a href="#">Featured Collection</a></li>
                    </ul>
                </div>
            </div>

            <!-- Exclusive Benefits Section -->
            <div class="footer-section">
                <button class="footer-toggle" data-section="benefits-content">
                    <span class="footer-title">Exclusive benefits</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="footer-content" id="benefits-content">
                    <ul>
                        <li><a href="#">VIP Customer Program</a></li>
                        <li><a href="#">Free Shipping</a></li>
                        <li><a href="#">30-Day Returns</a></li>
                        <li><a href="#">Lifetime Warranty</a></li>
                        <li><a href="#">Personal Styling</a></li>
                        <li><a href="#">Early Access</a></li>
                        <li><a href="#">Member Discounts</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
            <div class="container">
                <div class="footer-info">
                    <div class="copyright">
                        <p>&copy; 2025 Nazakat. All rights reserved. | Developed by <a href="https://savannaik.netlify.app/" target="_blank" style="color: #9c7c38; text-decoration: none; font-weight: 500;">Savan Naik</a></p>
                    </div>

                    <div class="footer-links">
                        <a href="terms-and-conditions.html">Terms and conditions</a>
                        <a href="privacy-policy.html">Privacy policy</a>
                
                    </div>

                    <div class="payment-methods">
                        <span><i class="fab fa-cc-amex"></i></span>
                       <!-- <span><i class="fab fa-apple-pay"></i></span>
                        <span><i class="fab fa-cc-diners-club"></i></span>-->
                        <span><i class="fab fa-cc-discover"></i></span>
                        <span><i class="fab fa-google-pay"></i></span>
                        <span><i class="fab fa-cc-mastercard"></i></span>
                        <span><i class="fab fa-cc-paypal"></i></span>
                        <span class="union-pay">UP</span>
                        <span><i class="fab fa-cc-visa"></i></span>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </footer>
                    

    <!-- Simple Network Monitoring -->
    <script>
      // Network status monitoring
      let isOnline = navigator.onLine;
      window.addEventListener('online', () => {
        console.log('Network connection restored');
        isOnline = true;
      });
      window.addEventListener('offline', () => {
        console.log('Network connection lost');
        isOnline = false;
      });
    </script>


    <script src="js/navigation.js?v=1.0.4"></script>
    <script src="js/banner-rotator.js?v=1.0.1"></script>
    <script src="js/product-gallery.js?v=1.0.1"></script>

    <!-- New Cart System -->
    <script src="js/firebase/firebase-auth.js"></script>
    <script src="js/cart-local-storage.js?v=1.0.0"></script>
    <script src="js/firebase/firebase-cart-manager.js?v=1.0.0"></script>
    <script src="js/cart-manager.js?v=1.0.1"></script>

    <!-- Wishlist Scripts -->
    <script src="js/wishlist-local-storage.js?v=1.0.0"></script>
    <script src="js/firebase/firebase-wishlist-manager.js?v=1.0.0"></script>
    <script src="js/wishlist-manager.js?v=1.0.0"></script>
    <script src="js/main.js"></script>

    <!-- Product Detail Page Cart Integration -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure Firebase is initialized before proceeding
            // Wait for Firebase and product data to be properly initialized
            setTimeout(function() {
                console.log('Product detail page scripts initialized');

                // Check if the product is already in the wishlist 
                // Keep this function but don't change the button appearance
                function updateWishlistButtonState() {
                    // We're keeping the function but not changing button appearance as requested
                    console.log('Wishlist button will maintain its original appearance');
                }

                // Initial update of wishlist button state
                updateWishlistButtonState();

                // Get DOM elements
                const addToCartBtn = document.querySelector('.add-to-cart-btn');
                const addToWishlistBtn = document.querySelector('.add-to-wishlist-btn');
                const quantityInput = document.querySelector('.quantity-input');
                const incrementBtn = document.querySelector('.quantity-btn.increment');
                const decrementBtn = document.querySelector('.quantity-btn.decrement');
                // Get Buy Now button
                const buyNowBtn = document.querySelector('.buy-now-btn');

                // Quantity controls
                incrementBtn.addEventListener('click', function() {
                    let currentQty = parseInt(quantityInput.value);
                    quantityInput.value = currentQty + 1;
                });

                decrementBtn.addEventListener('click', function() {
                    let currentQty = parseInt(quantityInput.value);
                    if (currentQty > 1) {
                        quantityInput.value = currentQty - 1;
                    }
                });

                // Toast notification function
                function showToast(message, type = 'success') {
                    // Create toast container if it doesn't exist
                    let toastContainer = document.querySelector('.toast-container');
                    if (!toastContainer) {
                        toastContainer = document.createElement('div');
                        toastContainer.className = 'toast-container';
                        document.body.appendChild(toastContainer);

                        // Add style for toast container
                        const style = document.createElement('style');
                        style.textContent = `
                            .toast-container {
                                position: fixed;
                                bottom: 20px;
                                right: 20px;
                                z-index: 9999;
                            }
                            .toast {
                                padding: 12px 20px;
                                color: white;
                                border-radius: 4px;
                                margin-bottom: 10px;
                                min-width: 250px;
                                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                                animation: fadein 0.5s, fadeout 0.5s 2.5s;
                                opacity: 0;
                                animation-fill-mode: forwards;
                            }
                            .toast.success {
                                background-color: #4CAF50;
                            }
                            .toast.error {
                                background-color: #F44336;
                            }
                            .toast.info {
                                background-color: #2196F3;
                            }
                            @keyframes fadein {
                                from {opacity: 0; transform: translateY(20px);}
                                to {opacity: 1; transform: translateY(0);}
                            }
                            @keyframes fadeout {
                                from {opacity: 1; transform: translateY(0);}
                                to {opacity: 0; transform: translateY(-20px);}
                            }
                        `;
                        document.head.appendChild(style);
                    }

                    // Create toast element
                    const toast = document.createElement('div');
                    toast.className = `toast ${type}`;
                    toast.textContent = message;

                    // Add to container
                    toastContainer.appendChild(toast);

                    // Remove after animation
                    setTimeout(() => {
                        toast.remove();
                    }, 3000);
                }

                // We already have a reference to buy now button from above
                // No need to declare buyNowBtn again

                // Add to cart is now handled by cart-manager.js
                // Remove duplicate handler to prevent conflicts
                console.log('Add to cart will be handled by CartManager');

                // Buy Now button click handler
                if (buyNowBtn) {
                    buyNowBtn.addEventListener('click', async function() {
                        const quantity = parseInt(quantityInput.value);
                        
                        // Get current product details from DOM
                        const currentProductDetails = getCurrentProductDetails();
                        
                        if (!currentProductDetails) {
                            showToast('Please wait for product to load completely', 'error');
                            return;
                        }

                        try {
                            // Check if CartManager is available
                            if (typeof CartManager !== 'undefined' && CartManager.addToCart) {
                                console.log('Using CartManager to add product to cart for buy now');
                                await CartManager.addToCart(currentProductDetails, quantity);

                                // Redirect to checkout page
                                console.log('Redirecting to checkout page');
                                window.location.href = 'checkout.html';
                            } else {
                                console.error('CartManager not available for buy now');
                                showToast('Error processing order. Please try again.', 'error');
                            }
                        } catch (error) {
                            console.error('Error in buy now flow:', error);
                            showToast('Error processing order. Please try again.', 'error');
                        }
                    });
                }
                
                // Helper function to get current product details from DOM
                function getCurrentProductDetails() {
                    const titleEl = document.querySelector('.product-title');
                    const priceEl = document.querySelector('.price-value');
                    const imageEl = document.querySelector('.product-main-image');
                    const containerEl = document.querySelector('.product-detail-container');
                    
                    const name = titleEl ? titleEl.textContent.trim() : '';
                    const priceText = priceEl ? priceEl.textContent.trim() : '';
                    
                    // Use global product details if available (most reliable)
                    if (window.productDetails && window.productDetails.id) {
                        console.log('Using global product details for buy now');
                        return {
                            id: window.productDetails.id,
                            name: window.productDetails.name || name,
                            price: window.productDetails.price || parseFloat(priceText.replace(/[^0-9.]/g, '')),
                            image: window.productDetails.image || (imageEl ? imageEl.src : '')
                        };
                    }
                    
                    // Fallback to DOM parsing
                    const price = parseFloat(priceText.replace(/[^0-9.]/g, ''));
                    const productId = containerEl ? containerEl.dataset.productId : '';
                    const imageSrc = imageEl ? imageEl.src : '';
                    
                    // Validate we have minimum required data
                    if (!name || !productId || isNaN(price) || price <= 0) {
                        console.warn('Incomplete product data:', { name, productId, price });
                        return null;
                    }
                    
                    return {
                        id: productId,
                        name: name,
                        price: price,
                        image: imageSrc
                    };
                }

                // NOTE: The wishlist button click handler is managed by WishlistManager.js
                // We're removing the duplicate event listener here to prevent conflicts
                // The button will still work through the centralized WishlistManager
            }, 500); // 500ms delay to ensure Firebase is loaded
        });
    </script>
    <!-- Updated layout version -->

    <!-- Cart Panel -->
    <div id="auricCartPanel" class="cart-panel" style="position:fixed !important; top:0 !important; right:-400px !important; width:400px !important; max-width:90% !important; height:100% !important; background:#ffffff !important; box-shadow:-2px 0 10px rgba(0,0,0,0.3) !important; z-index:999999 !important; transition:right 0.3s ease-in-out !important; display:flex !important; flex-direction:column !important; overflow:hidden !important; visibility:visible !important; pointer-events:auto !important;">
      <div class="cart-panel-header">
        <h3>Your Shopping Bag</h3>
        <button class="close-cart-btn" onclick="closeCartDirectly(); return false;">×</button>
      </div>
      <div class="cart-items">
        <!-- Cart items will be inserted here by JavaScript -->
        <div class="empty-cart-message">Your cart is empty</div>
      </div>
      <div class="cart-panel-footer">
        <div class="cart-panel-subtotal">
          <span>Subtotal:</span>
          <span class="subtotal-amount">₹0.00</span>
        </div>
        <div class="cart-panel-buttons">
          <button class="view-cart-btn continue-shopping-btn" onclick="closeCartDirectly(); return false;">Continue Shopping</button>
          <a href="checkout.html" class="checkout-btn">Checkout</a>
        </div>
      </div>
    </div>

    <!-- Ultra-direct Cart Overlay with ALL inline styles -->
    <div id="auricCartOverlay" class="cart-overlay" onclick="closeCartDirectly(); return false;" style="position:fixed !important; top:0 !important; left:0 !important; width:100% !important; height:100% !important; background:rgba(0,0,0,0.5) !important; z-index:999998 !important; display:none !important; visibility:hidden !important;"></div>
        <!-- Fix for closeCartDirectly error -->
    <script>
      // Define the missing closeCartDirectly function
      window.closeCartDirectly = function() {
        // Call the regular closeCart function
        if (window.closeCart) {
          return window.closeCart();
        }
      };
    </script>

    <!-- You May Also Like Products Loader -->
    <script>
        // Function to load random products for "You May Also Like" section
        async function loadYouMayAlsoLikeProducts() {
            try {
                console.log('Loading products for "You May Also Like" section...');
                
                const container = document.getElementById('you-may-also-like-container');
                if (!container) {
                    console.log('Container not found for "You May Also Like" section');
                    return;
                }
                
                // Get current product ID from URL or global variable
                const urlParams = new URLSearchParams(window.location.search);
                const currentProductId = urlParams.get('id') || (window.productDetails ? window.productDetails.id : null);
                
                console.log('Current product ID:', currentProductId);
                
                // Load all products from all collections using Netlify CDN
                const categories = ['featured-collection', 'new-arrivals', 'saree-collection'];
                let allProducts = [];
                
                for (const category of categories) {
                    try {
                        const timestamp = Date.now();
                        const response = await fetch(`/.netlify/functions/load-products?category=${category}&t=${timestamp}`);
                        
                        if (response.ok) {
                            const data = await response.json();
                            const products = data.products || [];
                            console.log(`Loaded ${products.length} products from ${category} via Netlify CDN`);
                            allProducts = allProducts.concat(products);
                        } else {
                            console.warn(`Failed to load products from ${category} via Netlify CDN:`, response.status);
                        }
                    } catch (error) {
                        console.warn(`Error loading ${category} products via Netlify CDN:`, error);
                    }
                }
                
                console.log(`Total products loaded: ${allProducts.length}`);
                
                // Filter out the current product
                const filteredProducts = allProducts.filter(product => product.id !== currentProductId);
                console.log(`Products after filtering current product: ${filteredProducts.length}`);
                
                // Shuffle the products array to get random order
                const shuffledProducts = filteredProducts.sort(() => Math.random() - 0.5);
                
                // Take first 6 products for display
                const productsToShow = shuffledProducts.slice(0, 6);
                console.log(`Products to display: ${productsToShow.length}`);
                
                if (productsToShow.length === 0) {
                    container.innerHTML = '<div class="no-products-message">No related products found</div>';
                    return;
                }
                
                // Generate HTML for products
                const productsHTML = productsToShow.map(product => {
                    const formattedPrice = new Intl.NumberFormat('en-IN', {
                        style: 'currency',
                        currency: 'INR',
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0
                    }).format(product.price).replace('₹', '₹');
                    
                    // Handle different image structures between categories
                    let imageUrl;
                    if (product.mainImage) {
                        // Featured collection uses mainImage
                        imageUrl = product.mainImage;
                    } else if (product.image) {
                        // New arrivals and saree collection use image
                        imageUrl = product.image;
                    } else if (product.images && product.images.length > 0) {
                        // Fallback to first image in images array
                        imageUrl = product.images[0].url;
                    } else {
                        // Fallback placeholder
                        imageUrl = '/images/placeholder-product.jpg';
                    }
                    
                    console.log(`Product ${product.id} image URL:`, imageUrl);
                    
                    return `
                        <div class="product-item" data-product-id="${product.id}" onclick="window.location.href='product-detail.html?id=${product.id}'">
                            <div class="product-image">
                                <img src="${imageUrl}" alt="${product.name}" loading="lazy" onerror="console.error('Image failed to load:', '${imageUrl}'); this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <div class="image-fallback" style="display:none; background:#f5f5f5; height:100%; display:flex; align-items:center; justify-content:center; color:#999; font-size:12px; text-align:center; padding:10px;">${product.name}</div>
                                <button class="add-to-wishlist" onclick="event.stopPropagation(); if(window.WishlistManager) WishlistManager.toggleWishlist('${product.id}'); return false;"><i class="far fa-heart"></i></button>
                            </div>
                            <div class="product-details">
                                <h3 class="product-name">${product.name}</h3>
                                <div class="product-pricing">
                                    <span class="current-price">${formattedPrice}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Update the container with new products
                container.innerHTML = productsHTML;
                
                console.log('Successfully loaded "You May Also Like" products');
                
                // Initialize wishlist for the new products
                if (window.WishlistManager && window.WishlistManager.initializeWishlistButtons) {
                    setTimeout(() => {
                        window.WishlistManager.initializeWishlistButtons();
                    }, 100);
                }
                
            } catch (error) {
                console.error('Error loading "You May Also Like" products:', error);
                console.error('Error stack:', error.stack);
                console.error('Error message:', error.message);
                console.error('Error name:', error.name);
                
                const container = document.getElementById('you-may-also-like-container');
                if (container) {
                    container.innerHTML = `<div class="error-message">Unable to load related products<br><small>Error: ${error.message}</small></div>`;
                }
            }
        }
        
        // Load products when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Delay loading to ensure current product is loaded first
            setTimeout(loadYouMayAlsoLikeProducts, 1000);
        });
        
        // Also load when product details are updated (in case of navigation)
        window.addEventListener('productLoaded', function() {
            setTimeout(loadYouMayAlsoLikeProducts, 500);
        });
    </script>

    <!-- Product Detail Loader -->
    <script src="js/product-detail-loader.js"></script>
    <script src="js/product-gallery.js"></script>
</body>
</html>