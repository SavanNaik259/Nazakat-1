<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Auric Jewelry</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/checkout-styles.css">
    <!-- Razorpay SDK -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <!-- Site Styles -->
    <link rel="stylesheet" href="css/styles.css?v=1.0.4">
    <link rel="stylesheet" href="css/responsive.css?v=1.0.4">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <!-- Netlify Functions Helper -->
    <script src="js/netlify-helpers.js"></script>

    <!-- Note: Debug scripts removed as requested -->

    <!-- Firebase Config -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCrLCButDevLeILcBjrUCd9e7amXVjW-uI",
            authDomain: "auric-a0c92.firebaseapp.com",
            projectId: "auric-a0c92",
            storageBucket: "auric-a0c92.appspot.com",
            messagingSenderId: "878979958342",
            appId: "1:878979958342:web:e6092f7522488d21eaec47",
            measurementId: "G-ZYZ750JHMB"
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Using Firebase configuration for authentication and order storage');

            try {
                // Only initialize Firebase if it's not already initialized
                if (!firebase.apps || !firebase.apps.length) {
                    // Initialize Firebase
                    firebase.initializeApp(firebaseConfig);
                    console.log('Firebase initialized successfully');
                } else {
                    console.log('Firebase already initialized, using existing app');
                }

                // Check if user is logged in
                firebase.auth().onAuthStateChanged(function(user) {
                    console.log('Auth state changed:', user ? 'Logged in' : 'Not logged in');
                    // Update UI based on auth state
                    updateAuthUI(user);
                    // Load addresses if user is logged in
                    if (user) {
                        setTimeout(() => {
                            loadSavedAddresses();
                        }, 1000);
                    }
                });
            } catch (error) {
                console.error('Error initializing Firebase:', error);
            }
        });

        function updateAuthUI(user) {
            // Add login status indicator to the header
            const header = document.querySelector('.simple-header .container');
            // Auth status is not shown in the checkout page as per new design
        }
    </script>

    <style>
        /* Hide mobile menu close button on large devices */
        @media (min-width: 769px) {
            #closeMenu {
                display: none !important;
            }
        }

        /* Address Selection Styles */
        .address-option {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .address-option:hover {
            border-color: #603000;
            background-color: #fafafa;
        }

        .address-option.selected {
            border-color: #603000;
            background-color: #f8f6f0;
        }

        .address-option .address-type {
            font-weight: bold;
            color: #603000;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .address-option .address-details {
            color: #555;
            font-size: 14px;
            line-height: 1.4;
        }

        .default-badge {
            background-color: #603000;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: normal;
        }

        .address-radio {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .loading-addresses {
            text-align: center;
            color: #777;
            padding: 20px;
            font-style: italic;
        }

        .no-addresses {
            text-align: center;
            color: #777;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        #manual-address-form.hidden {
            display: none;
        }

        .address-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }

        /* Validation styles */
        .error-text {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
            position: relative;
            z-index: 1;
            background: #ffebee;
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #e74c3c;
            border-left: 4px solid #e74c3c;
        }

        .error-text.show {
            display: block;
        }

        .form-control.error {
            border-color: #e74c3c;
            box-shadow: 0 0 0 0.2rem rgba(231, 76, 60, 0.25);
        }

        .form-control.valid {
            border-color: #28a745;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        }

      /* Ultra-lightweight notification styles for mobile performance */
      .notification {
        position: fixed;
        top: 80px;
        left: 15px;
        right: 15px;
        max-width: 90%;
        margin: 0 auto;
        background-color: #333;
        color: white;
        padding: 12px 16px;
        border-radius: 6px;
        z-index: 9999;
        font-size: 14px;
        line-height: 1.3;
        text-align: center;
        pointer-events: auto;
        /* Remove transitions and shadows for better mobile performance */
        box-shadow: none;
        transform: none;
        transition: none;
        opacity: 1;
      }

      @media (min-width: 768px) {
        .notification {
          left: auto;
          right: 20px;
          max-width: 350px;
          margin: 0;
          text-align: left;
          padding: 15px 20px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
      }

      .notification.success {
        background-color: #4CAF50;
      }

      .notification.error {
        background-color: #F44336;
      }

      /* Form styling to match profile page */
      .form-group {
        margin-bottom: 25px;
        position: relative;
        z-index: 1;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
        position: relative;
        z-index: 1;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        transition: border-color 0.3s ease;
        position: relative;
        z-index: 1;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #603000;
      }

      .form-row {
        display: flex;
        gap: 15px;
      }

      .form-row .form-group {
        flex: 1;
      }

      /* Override Bootstrap form-control styles for consistency */
      .form-control {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-control:focus {
        outline: none;
        border-color: #603000;
        box-shadow: 0 0 0 0.2rem rgba(96, 48, 0, 0.25);
      }

      /* Simplified error styles for mobile performance */
      .form-control.error {
        border-color: #e74c3c;
        box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.2);
      }

      .form-control.valid {
        border-color: #28a745;
        box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);
      }

      /* Notification Popup Styles (for the modified function) */
      .notification-popup {
        position: fixed;
        top: 80px;
        left: 15px;
        right: 15px;
        max-width: 90%;
        margin: 0 auto;
        background-color: #333;
        color: white;
        padding: 12px 16px;
        border-radius: 6px;
        z-index: 9999;
        font-size: 14px;
        line-height: 1.3;
        text-align: center;
        opacity: 1;
        transition: opacity 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      @media (min-width: 768px) {
        .notification-popup {
          left: auto;
          right: 20px;
          max-width: 350px;
          margin: 0;
          text-align: left;
          padding: 15px 20px;
        }
      }

      .notification-popup.success {
        background-color: #4CAF50;
      }

      .notification-popup.error {
        background-color: #F44336;
      }

      .notification-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .notification-message {
        flex-grow: 1;
        margin-right: 10px;
      }

      .notification-close {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 0 5px;
      }

      /* Remove unused error text elements */
      .error-text {
        display: none !important;
      }
    </style>

    <script>
        // Validation functions for checkout form
        function setupCheckoutFormValidation() {
            const fields = [
                { id: 'firstName', validator: validateFirstName },
                { id: 'lastName', validator: validateLastName },
                { id: 'email', validator: validateEmail },
                { id: 'phone', validator: validatePhone },
                { id: 'pinCode', validator: validatePinCode, async: true },
                { id: 'houseNumber', validator: validateHouseNumber },
                { id: 'roadName', validator: validateRoadName },
                { id: 'city', validator: validateCity },
                { id: 'state', validator: validateState }
            ];

            fields.forEach(field => {
                const input = document.getElementById(field.id);
                if (input) {
                    if (field.async) {
                        input.addEventListener('blur', async () => await field.validator(input));
                    } else {
                        input.addEventListener('blur', () => field.validator(input));
                    }
                    input.addEventListener('input', () => {
                        clearFieldError(input);
                    });
                }
            });
        }

        function validateFirstName(input) {
            const value = input.value.trim();
            if (value.length < 2) {
                showFieldError(input, 'First name must be at least 2 characters long');
                return false;
            }
            clearFieldError(input);
            return true;
        }

        function validateLastName(input) {
            const value = input.value.trim();
            if (value.length < 2) {
                showFieldError(input, 'Last name must be at least 2 characters long');
                return false;
            }
            clearFieldError(input);
            return true;
        }

        function validateEmail(input) {
            const value = input.value.trim();
            const strictEmailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

            if (!strictEmailRegex.test(value)) {
                showFieldError(input, 'Please enter a valid email address with proper domain extension');
                return false;
            }

            const domain = value.split('@')[1];
            if (domain && (domain.includes('.co') && !domain.includes('.com') && !domain.includes('.co.in') && !domain.includes('.co.uk'))) {
                if (domain.endsWith('.co')) {
                    showFieldError(input, 'Email domain appears incomplete. Did you mean .com or .co.in?');
                    return false;
                }
            }

            if (domain && (domain.includes('gmail.co') && !domain.includes('gmail.com'))) {
                showFieldError(input, 'Invalid Gmail domain. Did you mean @gmail.com?');
                return false;
            }

            clearFieldError(input);
            return true;
        }

        function validatePhone(input) {
            const value = input.value.replace(/\D/g, '');
            if (value.length !== 10) {
                showFieldError(input, 'Please enter a valid 10-digit phone number');
                return false;
            }
            clearFieldError(input);
            return true;
        }

        async function validatePinCode(input) {
            const value = input.value.trim();
            if (!/^\d{6}$/.test(value)) {
                showFieldError(input, 'Please enter a valid 6-digit PIN code');
                return false;
            }

            // Real PIN code validation using postal service API
            try {
                console.log(`Validating PIN code ${value} using postal service API...`);

                // Direct API call to postal service
                const response = await fetch(`https://api.postalpincode.in/pincode/${value}`);
                const data = await response.json();

                if (data && data[0] && data[0].Status === 'Success') {
                    const postOffice = data[0].PostOffice[0];
                    const pinValidation = {
                        valid: true,
                        district: postOffice.District,
                        state: postOffice.State,
                        city: postOffice.Name,
                        region: postOffice.Region
                    };

                    console.log(`✅ PIN code validated: ${value} belongs to ${pinValidation.district}, ${pinValidation.state}`);

                    // Check if state matches
                    const stateSelect = document.getElementById('state');
                    if (stateSelect && stateSelect.value) {
                        const normalizeState = (state) => state.toLowerCase().replace(/\s+/g, ' ').trim();
                        const apiState = normalizeState(pinValidation.state);
                        const userState = normalizeState(stateSelect.value);

                        if (apiState !== userState) {
                            showFieldError(input, `PIN code ${value} belongs to ${pinValidation.state}, but you selected ${stateSelect.value}. Please verify your PIN code and state.`);
                            return false;
                        }
                    }

                    // Store PIN validation result for later use
                    input.dataset.pinValidation = JSON.stringify(pinValidation);

                    // Only show success notification if all other fields are valid
                    const allFieldsValid = await checkAllOtherFieldsValid();
                    if (allFieldsValid) {
                        showNotification(`PIN code verified: ${value} belongs to ${pinValidation.district}, ${pinValidation.state}`, 'success');
                    }

                    clearFieldError(input);
                    return true;
                } else {
                    showFieldError(input, `PIN code ${value} is not valid. Please check and enter a correct PIN code.`);
                    return false;
                }
            } catch (error) {
                console.warn('PIN code validation API failed:', error);
                // Show warning but allow to continue
                showNotification('Could not validate PIN code online. Please ensure it is correct.', 'error');
                clearFieldError(input);
                return true; // Allow to continue if API is down
            }
        }

        // Helper function to check if all other fields (except PIN code) are valid
        async function checkAllOtherFieldsValid() {
            const fields = [
                { id: 'firstName', validator: validateFirstName },
                { id: 'lastName', validator: validateLastName },
                { id: 'email', validator: validateEmail },
                { id: 'phone', validator: validatePhone },
                { id: 'houseNumber', validator: validateHouseNumber },
                { id: 'roadName', validator: validateRoadName },
                { id: 'city', validator: validateCity },
                { id: 'state', validator: validateState }
            ];

            for (const field of fields) {
                const input = document.getElementById(field.id);
                if (input && field.validator) {
                    const isValid = field.validator(input);
                    if (!isValid) {
                        return false;
                    }
                }
            }
            return true;
        }

        function validateHouseNumber(input) {
            const value = input.value.trim();
            if (value.length < 1) {
                showFieldError(input, 'House/Building number is required');
                return false;
            }

            // Check for invalid patterns
            if (/^0+$/.test(value)) {
                showFieldError(input, 'Please enter a valid house/building number (cannot be all zeros)');
                return false;
            }

            // Check for minimum meaningful length
            if (value.length < 1 || (value.length === 1 && value === '0')) {
                showFieldError(input, 'Please enter a valid house/building number');
                return false;
            }

            // Check for valid characters (alphanumeric, dash, slash, space allowed)
            if (!/^[a-zA-Z0-9-\/\s]+$/.test(value)) {
                showFieldError(input, 'House/Building number can only contain letters, numbers, hyphens, slashes, and spaces');
                return false;
            }

            clearFieldError(input);
            return true;
        }

        function validateRoadName(input) {
            const value = input.value.trim();
            if (value.length < 5) {
                showFieldError(input, 'Road name/Area/Colony must be at least 5 characters long');
                return false;
            }
            clearFieldError(input);
            return true;
        }

        function validateCity(input) {
            const value = input.value.trim();
            if (value.length < 2) {
                showFieldError(input, 'City name must be at least 2 characters long');
                return false;
            }
            clearFieldError(input);
            return true;
        }

        function validateState(input) {
            const value = input.value.trim();
            if (value.length < 2) {
                showFieldError(input, 'Please select a valid state');
                return false;
            }
            clearFieldError(input);
            return true;
        }

        function showFieldError(input, message) {
            // Strong throttling for mobile performance - only show one error every 2 seconds
            const currentTime = Date.now();
            if (!window.lastNotificationTime || currentTime - window.lastNotificationTime > 2000) {
                // Clear any existing notifications before showing new one
                clearAllNotifications();
                showNotification(message, 'error');
                window.lastNotificationTime = currentTime;
            }

            // Add visual feedback to input (lightweight)
            input.classList.add('error');
            input.classList.remove('valid');
        }

        function clearFieldError(input) {
            input.classList.remove('error');
            input.classList.add('valid');

            // If this was the last invalid field and PIN code is already validated, show PIN success
            setTimeout(async () => {
                const pinCodeInput = document.getElementById('pinCode');
                if (pinCodeInput && pinCodeInput.dataset.pinValidation) {
                    const allFieldsValid = await checkAllOtherFieldsValid();
                    if (allFieldsValid) {
                        const pinValidation = JSON.parse(pinCodeInput.dataset.pinValidation);
                        clearAllNotifications();
                        showNotification(`PIN code verified: ${pinCodeInput.value} belongs to ${pinValidation.district}, ${pinValidation.state}`, 'success');
                        // Clear the stored validation so it doesn't show again
                        delete pinCodeInput.dataset.pinValidation;
                    }
                }
            }, 100);
        }

        // Global notification cleanup function
        function clearAllNotifications() {
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            });
            // Clear any pending timeouts
            if (window.notificationTimeout) {
                clearTimeout(window.notificationTimeout);
                window.notificationTimeout = null;
            }
        }

        // Modified showNotification function for improved performance and single popup
        let activeNotification = null;

        function showNotification(message, type = 'info') {
            // Prevent multiple notifications
            if (activeNotification) {
                activeNotification.remove();
                activeNotification = null;
            }

            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification-popup ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-message">${message}</span>
                    <button class="notification-close">&times;</button>
                </div>
            `;

            activeNotification = notification;

            // Add to page
            document.body.appendChild(notification);

            // Add click handler for close button
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => {
                if (activeNotification === notification) {
                    notification.remove();
                    activeNotification = null;
                }
            });

            // Auto-remove after 3 seconds (reduced time)
            setTimeout(() => {
                if (activeNotification === notification && notification.parentNode) {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        if (activeNotification === notification && notification.parentNode) {
                            notification.remove();
                            activeNotification = null;
                        }
                    }, 300);
                }
            }, 3000);
        }

        // Initialize validation when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                setupCheckoutFormValidation();
            }, 1000);
        });
    </script>
</head>
<body>
    <!-- Simple Header -->
    <header class="simple-header py-3 border-bottom">
        <div class="container d-flex justify-content-between align-items-center">
            <div>
                <a href="index.html" class="btn btn-outline-secondary custom-back-btn" style="color: #603000; border-color: #603000;">
                    <i class="fas fa-arrow-left me-1"></i> Back to Shopping
                </a>
            </div>
            <div>
                <!-- Right side is empty now -->
            </div>
        </div>
    </header>
    <!-- Overlay for menu background -->
    <div class="menu-overlay" id="menuOverlay"></div>

    <div class="container py-5">
        <header class="mb-5 text-center">
            <h1 class="display-4">Checkout</h1>
            <p class="lead">Complete your order in a few simple steps</p>
        </header>

        <!-- Checkout Steps Progress -->
        <div class="checkout-progress mb-5">
            <div class="row text-center">
                <div class="col-4">
                    <div class="step-icon active" id="step-icon-1">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="step-title">Order Summary</div>
                </div>
                <div class="col-4">
                    <div class="step-icon" id="step-icon-2">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="step-title">Shipping Address</div>
                </div>
                <div class="col-4">
                    <div class="step-icon" id="step-icon-3">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <div class="step-title">Payment</div>
                </div>
            </div>
            <div class="progress mt-3">
                <div class="progress-bar" role="progressbar" style="width: 33%" id="checkout-progress-bar"></div>
            </div>
        </div>

        <form id="checkoutForm">
            <!-- Step 1: Order Summary -->
            <div class="checkout-step active" id="checkout-step-1">
                <div class="row">

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Order Summary</h5>
                            </div>
                            <div class="card-body">
                                <div id="orderSummary">
                                    <p>No products added yet.</p>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <h5>Total:</h5>
                                    <h5 id="orderTotal">₹0.00</h5>
                                </div>

                                <div class="text-center mt-4">

                                    <a id="continue-to-address" class="btn continue-shopping-btn custom-continue-btn" style="color: #603000; border-color: #603000;">
                                        <i class="fas fa-store me-1"></i> Continue Shopping
                                    </a>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Delivery Address -->
            <div class="checkout-step" id="checkout-step-2">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">Shipping Address</h5>
                            </div>
                            <div class="card-body">
                                <!-- Saved Addresses Section (shown when user is logged in) -->
                                <div id="saved-addresses-section" style="display: none;">
                                    <div class="mb-4">
                                        <label class="form-label">Select a Saved Address</label>
                                        <div id="saved-addresses-container">
                                            <!-- Saved addresses will be loaded here -->
                                        </div>
                                        <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="use-new-address-btn">
                                            <i class="fas fa-plus"></i> Use New Address
                                        </button>
                                    </div>
                                </div>

                                <!-- Manual Address Form -->
                                <div id="manual-address-form">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="firstName">First Name *</label>
                                            <input type="text" id="firstName" name="firstName" required minlength="2" maxlength="50">
                                            <div class="error-text" id="firstName-error">Please enter a valid first name</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="lastName">Last Name *</label>
                                            <input type="text" id="lastName" name="lastName" required minlength="2" maxlength="50">
                                            <div class="error-text" id="lastName-error">Please enter a valid last name</div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="email">Email Address *</label>
                                        <input type="email" id="email" name="email" required>
                                        <div class="error-text" id="email-error">Please enter a valid email address</div>
                                    </div>

                                    <div class="form-group">
                                        <label for="phone">Phone Number *</label>
                                        <input type="tel" id="phone" name="phone"  required pattern="[0-9]{10}" maxlength="10" placeholder="1234567890">
                                        <div class="error-text" id="phone-error">Please enter a valid 10-digit phone number</div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="houseNumber">House/Building Number *</label>
                                            <input type="text" id="houseNumber" name="houseNumber" required maxlength="50">
                                            <div class="error-text" id="houseNumber-error">House/Building number is required</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="pinCode">PIN Code *</label>
                                            <input type="text" id="pinCode" name="pinCode" required pattern="[0-9]{6}" maxlength="6" placeholder="123456">
                                            <div class="error-text" id="pinCode-error">Please enter a valid 6-digit PIN code</div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="roadName">Road Name/Area/Colony *</label>
                                        <textarea id="roadName" name="roadName" rows="2" required minlength="5" maxlength="200" placeholder="Marine Drive, Churchgate"></textarea>
                                        <div class="error-text" id="roadName-error">Road name/Area must be at least 5 characters long</div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="city">City *</label>
                                            <input type="text" id="city" name="city"  required minlength="2" maxlength="50">
                                            <div class="error-text" id="city-error">City name must be at least 2 characters long</div>
                                        </div>
                                        <div class="form-group">
                                            <label for="state">State *</label>
                                            <select id="state" name="state" required>
                                              <option value="">Select State</option>
                                              <option value="Andhra Pradesh">Andhra Pradesh</option>
                                              <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                              <option value="Assam">Assam</option>
                                              <option value="Bihar">Bihar</option>
                                              <option value=" Chhattisgarh"> Chhattisgarh</option>
                                              <option value="Goa">Goa</option>
                                              <option value="Gujarat">Gujarat</option>
                                              <option value=" Haryana"> Haryana</option>
                                              <option value="Himachal Pradesh">Himachal Pradesh</option>
                                              <option value="Jharkhand">Jharkhand</option>
                                              <option value="Karnataka">Karnataka</option>
                                              <option value="Kerala">Kerala</option>
                                              <option value="Madhya Pradesh">Madhya Pradesh</option>
                                              <option value="Maharashtra" >Maharashtra</option>
                                              <option value="Manipur">Manipur</option>
                                              <option value="Meghalaya">Meghalaya</option>
                                              <option value="Mizoram">Mizoram</option>
                                              <option value="Nagaland">Nagaland</option>
                                              <option value="Odisha">Odisha</option>
                                              <option value="Punjab">Punjab</option>
                                              <option value="Rajasthan">Rajasthan</option>
                                              <option value="Sikkim">Sikkim</option>
                                              <option value="Tamil Nadu">Tamil Nadu</option>
                                              <option value="Telangana">Telangana</option>
                                              <option value="Tripura">Tripura</option>
                                              <option value="Uttar Pradesh">Uttar Pradesh</option>
                                              <option value="Uttarakhand">Uttarakhand</option>
                                              <option value="West Bengal">West Bengal</option>
                                              <option value="Delhi">Delhi</option>
                                              <option value="Puducherry">Puducherry</option>
                                              <option value="Chandigarh">Chandigarh</option>
                                              <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                              <option value="Ladakh">Ladakh</option>
                                              <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                                              <option value="Lakshadweep">Lakshadweep</option>
                                              <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                                            </select>
                                            <div class="error-text" id="state-error">Please select a State</div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="notes">Order Notes (Optional)</label>
                                        <textarea id="notes" name="notes" rows="2" placeholder="Please deliver in the evening after 6 PM."></textarea>
                                    </div>

                                    <!-- Save Address Option for logged in users -->
                                    <div id="save-address-option" style="display: none;">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="saveAddress" name="saveAddress">
                                            <label class="form-check-label" for="saveAddress">
                                                Save this address for future orders
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between mt-3">
                            <button type="button" class="btn btn-outline-secondary" id="back-to-summary">Back</button>
                            <button type="button" class="btn btn-primary" id="continue-to-payment">Continue to Place Order</button>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Order Summary</h5>
                            </div>
                            <div class="card-body">
                                <div id="orderSummaryStep2">
                                    <p>No products added yet.</p>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <h5>Total:</h5>
                                    <h5 id="orderTotalStep2">₹0.00</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Payment Method -->
            <div class="checkout-step" id="checkout-step-3">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">Payment Method</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-4">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="radio" name="paymentMethod" id="cashOnDelivery" value="Cash on Delivery" checked>
                                        <label class="form-check-label" for="cashOnDelivery">
                                            <i class="fas fa-money-bill-wave me-2"></i> Cash on Delivery
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="paymentMethod" id="razorpay" value="Razorpay">
                                        <label class="form-check-label" for="razorpay">
                                            <i class="fas fa-credit-card me-2"></i> Pay Online with Razorpay
                                            <img src="https://razorpay.com/assets/razorpay-logo.svg" alt="Razorpay" style="height: 20px; margin-left: 5px;">
                                        </label>
                                    </div>
                                </div>

                                <div class="address-summary mt-4">
                                    <h6 class="mb-3">Shipping Address</h6>
                                    <div class="card bg-light">
                                        <div class="card-body" id="address-confirmation">
                                            <p>Please complete the address section.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Hidden Product List - Used by JavaScript to store products -->
                                <div id="productList" style="display: none;">
                                    <!-- Product items will be added here by JavaScript -->
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between mt-3">
                            <button type="button" class="btn btn-outline-secondary" id="back-to-address">Back</button>
                            <button type="submit" class="btn btn-primary">Complete Order</button>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Order Summary</h5>
                            </div>
                            <div class="card-body">
                                <div id="orderSummaryStep3">
                                    <p>No products added yet.</p>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <h5>Total:</h5>
                                    <h5 id="orderTotalStep3">₹0.00</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">Error</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="errorMessage"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Required Modal -->
    <div class="modal fade" id="createAccountModal" tabindex="-1" aria-labelledby="createAccountModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createAccountModalLabel">Authentication Required</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        You need to create an account or sign in to complete your purchase.
                    </div>
                    <p>Please create an account or sign in to complete your order. Creating an account allows you to:</p>
                    <ul>
                        <li>Track your order status</li>
                        <li>Save your delivery information for future purchases</li>
                        <li>View your order history</li>
                        <li>Receive exclusive offers and discounts</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a href="login.html" class="btn btn-outline-primary">Sign In</a>
                    <a href="signup.html" class="btn btn-primary">Create Account</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Order Confirmation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-success" role="alert">
                        <h4 class="alert-heading">Thank you for your order!</h4>
                        <p>Your order has been placed successfully. We'll send you a confirmation email shortly.</p>
                        <hr>
                        <p class="mb-0">Order Reference: <span id="orderReference"></span></p>
                        <div id="paymentDetails" class="mt-2" style="display: none;">
                            <p class="mb-0"><strong>Payment ID:</strong> <span id="paymentId"></span></p>
                            <p class="mb-0"><strong>Payment Method:</strong> <span id="paymentMethod"></span></p>
                        </div>
                    </div>
                    <div id="orderDetails"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="closeConfirmationBtn" data-bs-dismiss="modal">Return to Homepage</button>
                </div>
            </div>
        </div>
    </div>





    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- New Cart System -->
    <script src="js/cart-local-storage.js?v=1.0.0"></script>
    <script src="js/firebase/firebase-cart-manager.js?v=1.0.0"></script>

    <!-- Wishlist Scripts -->
    <script src="js/wishlist-local-storage.js?v=1.0.0"></script>
    <script src="js/firebase/firebase-wishlist-manager.js?v=1.0.0"></script>
    <script src="js/wishlist-manager.js?v=1.0.0"></script>

    <!-- Firebase Address Manager -->
    <script src="js/firebase/firebase-address-manager.js?v=1.0.0"></script>

    <!-- JavaScripts -->
    <script>
        console.log("Loading cart dependencies for improved cart system");
    </script>
    <!-- Firebase Initialization (if available) -->
    <script src="js/firebase/firebase-init.js"></script>

    <!-- Stock Management System -->
    <script src="js/stock-manager.js"></script>

    <!-- Order Management for Authenticated Users -->
    <script src="js/firebase/firebase-orders.js"></script>

    <!-- Address Management for Authenticated Users -->
    <script src="js/firebase/firebase-address-manager.js"></script>

    <!-- Checkout Script -->
    <script src="js/checkout-script-simplified.js"></script>

    <a href="https://wa.me/919310250047?text=Hi! I need help with my order. Can you assist me?" class="whatsapp-btn">
        <i class="fab fa-whatsapp"></i>
    </a>
    <!-- Footer Toggle Script -->
        <script src="js/footer-toggle.js"></script>

    <!-- Minimalist Collapsible Footer -->
        <footer class="footer-minimalist">
            <div class="container">
                <!-- Info Section -->
                <div class="footer-section">
                    <button class="footer-toggle" data-section="info-content">
                        <span class="footer-title">Info</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="footer-content" id="info-content">
                        <ul>
                            <li><a href="#">Our Story</a></li>
                            <li><a href="#">Shipping Policy</a></li>
                            <li><a href="#">Returns & Exchanges</a></li>
                            <li><a href="#">Size Guide</a></li>
                            <li><a href="#">Care Instructions</a></li>
                            <li><a href="#">Terms and Conditions</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Categories Section -->
                <div class="footer-section">
                    <button class="footer-toggle" data-section="categories-content">
                        <span class="footer-title">Categories</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="footer-content" id="categories-content">
                        <ul>
                            <li><a href="#">Saree</a></li>
                            <li><a href="#">Lehenga</a></li>
                            <li><a href="#">Suit</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Collection Section -->
                <div class="footer-section">
                    <button class="footer-toggle" data-section="collection-content">
                        <span class="footer-title">Collection</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="footer-content" id="collection-content">
                        <ul>

                            <li><a href="#">New Arrivals</a></li>
                            <li><a href="#">Saree Collection</a></li>
                            <li><a href="#">Featured Collection</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Exclusive Benefits Section -->
                <div class="footer-section">
                    <button class="footer-toggle" data-section="benefits-content">
                        <span class="footer-title">Exclusive benefits</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="footer-content" id="benefits-content">
                        <ul>
                            <li><a href="#">VIP Customer Program</a></li>
                            <li><a href="#">Free Shipping</a></li>
                            <li><a href="#">30-Day Returns</a></li>
                            <li><a href="#">Lifetime Warranty</a></li>
                            <li><a href="#">Personal Styling</a></li>
                            <li><a href="#">Early Access</a></li>
                            <li><a href="#">Member Discounts</a></li>
                        </ul>
                    </div>
                </div>

        <div class="footer-bottom">
            <div class="container">
                <div class="footer-info">
                    <div class="copyright">
                        <p>&copy; 2025 SP Jewellers. All rights reserved. | Developed by <a href="https://savannaik.netlify.app/" target="_blank" style="color: #9c7c38; text-decoration: none; font-weight: 500;">Savan Naik</a></p>
                    </div>

                    <div class="footer-links">
                        <a href="terms-conditions.html">Terms and Conditions</a>
                        <a href="privacy-policy.html">Privacy Policy</a>
                    </div>

                    <div class="payment-methods">
                        <span><i class="fab fa-cc-amex"></i></span>
                       <!-- <span><i class="fab fa-apple-pay"></i></span>
                        <span><i class="fab fa-cc-diners-club"></i></span>-->
                        <span><i class="fab fa-cc-discover"></i></span>
                        <span><i class="fab fa-google-pay"></i></span>
                        <span><i class="fab fa-cc-mastercard"></i></span>
                        <span><i class="fab fa-cc-paypal"></i></span>
                        <span class="union-pay">UP</span>
                        <span><i class="fab fa-cc-visa"></i></span>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Shop JS for filtering and sorting --
    <script src="js/shop.js"></script>

    <!-- Core JS Files --
    <script src="js/navigation.js?v=1.0.4"></script>
    <script src="js/banner-rotator.js?v=1.0.1"></script>
    <script src="js/error-handler.js"></script>
    <script src="js/firebase/firebase-auth.js"></script>
    <script src="js/cart-local-storage.js?v=1.0.0"></script>
    <script src="js/firebase/firebase-cart-manager.js?v=1.0.0"></script>
    <script src="js/cart-manager.js?v=1.0.1"></script>
    <script src="js/wishlist-local-storage.js?v=1.0.0"></script>
    <script src="js/firebase/firebase-wishlist-manager.js?v=1.0.0"></script>
    <script src="js/wishlist-manager.js?v=1.0.0"></script>
    <script src="js/main.js"></script>
-->

</body>
</html>